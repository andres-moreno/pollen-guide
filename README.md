# A poor guide to Pollen
The [official Pollen documentation](pkg-build.racket-lang.org/doc/pollen/) is a rich and hearty repast. That may be why it took me longer than expected to get where I wanted to go.

So, here's a poor and meagre introduction that may help others get started as quickly as possible.

## Goal
I'm trying to write Pollen markup that generates Dave Liepmann's [Tufte CSS](http://www.daveliepmann.com/tufte-css/)-compliant HTML. Tufte CSS has some nice rules for sidenotes and headings that I'd like to write for, without writing HTML.

## Preliminaries
Install [Racket](http://download.racket-lang.org/)

> On **Mac OS X**, verify the installation location by running `$ /Applications/Racket\ v6.2.1/bin/racket -v`, then add the following to your `~/.bash_profile`: 
```bash
export PATH="$PATH:/Applications/Racket v6.2.1/bin"
```

Then install Pollen by running `$ raco pkg install pollen` and answering "yes" a couple of times.

Now. After reading portions of [three](http://pkg-build.racket-lang.org/doc/pollen/first-tutorial.html) [longform](http://pkg-build.racket-lang.org/doc/pollen/second-tutorial.html) [tutorials](http://pkg-build.racket-lang.org/doc/pollen/third-tutorial.html) ([fourth](http://pkg-build.racket-lang.org/doc/pollen/fourth-tutorial.html) available), a [mini-tutorial](http://pkg-build.racket-lang.org/doc/pollen/mini-tutorial.html), and a [quick tour](http://pkg-build.racket-lang.org/doc/pollen/quick-tour.html), you will likely be very excited about many things. But for purposes of this poor guide, you can forget everything about DrRacket, `.pp` Pollen preprocessor files, `.pmd` & Pollen-Markdown mode, the Pollen project server (`raco pollen start`), etc.

We'll be writing Pollen markup directly in `.html.pm` files, rendering them from the command line with `raco pollen render`, and viewing just the result in a browser. Clone this repository and follow along.

**N.B.** I'm assuming you have some passing familiarity with the Lisp family, from Common Lisp or Emacs Lisp or Scheme or Clojure or somewhere. The examples that follow have enough weird Pollen awesomeness that I can't stop and explain symbols or [`,@ unquote-splicing`](http://docs.racket-lang.org/guide/qq.html). But I will try to point out Racketisms to save you some Googling, though it's always a good idea to [Learn X=Racket in Y Minutes](http://learnxinyminutes.com/docs/racket/).

## Take One. Basic and not-so-basic functionality.
In the `take1/` directory there are
- two input files: Pollen markup in `take1.html.pm` and an HTML template `template.html`,
- one helper file: the `tufte.css` file from Liepmann, and
- out output file: `take1.html` which is generated by running `raco pollen render take1.html`.

The reason you could forget about Markdown and the Pollen preprocessor is because these are small fry compared to real Pollen markup. In the Pollen markup file `take1/take1.html.pm`, we have some Racket function definitions starting with ◊, then a bunch of content. Wait, maybe I overstated the difference between Racket code versus content, because what's the difference between
- ``◊(define (emphatic . xs) `(em ,@xs))``, and
- ``◊emphatic{italicize things}``? Or, worse,
- ``◊h1{Take One. Or, Let's Try To Get the Basics.}``?

### Pollen text mode versus Racket mode: Pollen's two syntaxes for calling functions
Here's the first thing you need to know. There's a **one-to-one equivalence** between 
- `◊foo[arg1 arg2]{final-arg}`, which [is called](http://pkg-build.racket-lang.org/doc/pollen/reader.html#%28part._.The_two_command_modes__text_mode___.Racket_mode%29) Pollen text mode, and 
- `◊(foo arg1 arg2 final-arg)` which is Racket mode.

Both call a Racket function `foo`. If the existence of this isomorphism strikes you as pretty freaking amazing, it should, and not just from a theoretical sense. It allows you to treat `foo` as a Racket function using the latter, and as an *equivalent* HTML tag with the former. 

### Pollen forgives undefined functions
The other thing you need to know is also awesome: **if Pollen finds you using functions-tags that you haven't `define`d, it'll treat them as plain HTML tags**. This is why `take1.html.pm` can call `◊h1{Take One …}` without anybody defining `h1` anywhere.

Put the two of these factoids together and you see why we can use `◊span` as 
- a Pollen tag via `◊span['((class "hidden") (id "id1"))]{my span}`, 
- **and** as a Racket function via `◊(span '((class "hidden") (id "id2")) "my other span")`, without explicitly defining `span`.

Of course you can see that, while they're equivalent, in practice it's easier to use one syntax in for some situations and the other for others, if only because you don't need to quote text when you use `◊span{look ma, no quotes!}`.

### Explaining aforementioned usages
Now you can understand those three lines of code above.

``◊(define (emphatic . xs) `(em ,@xs))`` is written using Racket mode syntax, and defines a function called `emphatic` with all arguments rolled into a list called `xs` (just like `def foo(*args)` in Python or `varargin` in other languages), and which returns the input arguments list `xs` prepended with the symbol `em` using a bit of that [quasiquote](http://docs.racket-lang.org/guide/qq.html) magic the Lisp family is famed for.

We invoke this function using `◊emphatic{italicized text}`, and it renders as `<em>italicized text</em>`.

And as Pollen smartly passes through undefined functions as tags, ``◊h1{Take One. Or, Let's Try To Get the Basics.}`` produces the appropriate `<h1>` tag.

### Build and see
So in `take1/`, run `$ raco pollen render take1.html`. Unlike other markup translators, it doesn't write to stdout, and will overwrite `take1.html`. Open it in your browser—or start a webserver, since we'll be doing that in subsequent takes. If you have a working Python installation, run
```
$ python -m SimpleHTTPServer 9090
```
to launch a webserver serving the current directory, and open [http://localhost:9090/take1.html](http://localhost:9090/take1.html) in your browser.

Later, we'll actually set up the Nginx server as a super-powered alternative to SimpleHTTPServer, and though it doesn't directly pertain to Pollen, it does enable a smoother and richer authoring environment. Stay tuned for that.


### Summary of Take One

… explain the template!

## Take Two.

… Move the sidenote/splice business here, and include whitespace detection in this take. Take three can be the nginx/push-stream magic.
